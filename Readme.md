[JSONRPC-BROKER](#jsonrpc-broker) - брокер JSONRPC-сообщений по заданному набору правил распределяет их по целям

# JSONRPC-BROKER

Позволяет управлять входящим потоком сообщений jsonrpc-сообщений распределяя их по целям в соответствии с заданными правилами. Например можно вызов конкретного 
метода отправить в отдельную очередь или же запретить его. Правило можно задать для нескольких методов с учетом входящих параметров запроса в том числе и с 
использованием регулярных выражений. Работает только со входящим потоком (запросы и уведомления).

```cpp
{
  "name": "jsonrpc-broker1",
  "enabled": true,

  /* В режиме suspend отправляет все запросы без проверки в 'target' */
  "suspend": false,

  /* Цель по умолчанию (имя объекта), если сообщение не подошло */
  "target": "<<target-name>>",

  /* Список запрещенных методов (клиент получает "Procedure not found") */
  "reject": ["<<method-name-1>>", "<<method-name-2>>"],

  /**/
  std::string target_log;
  /**/
  std::string reject_log;

  /* Список правил */
  "rules": [
    {/*правило1*/},
    {/*правило2*/}
  ]
}
```
* *target* - имя объекта, которому будет передан запрос, который не подошел ни к одному из правил. Может быть пустым, в этом случае в ответ отсылается стандартная для WFC JSONRPC-ошибка, что сервис не доступен
* *reject* - все вызовы методов из этого списка блокируются, правила не проверяются, клиент получает JSONRPC-ошибку, что процедура не найдена. 
* *rules* - список правил (см. следующий раздел)

## Правила для методов

Правила применяются последовательно, в тоже последовательности, как и задано в конфигурации, до тех пор пока не выполнится 
```cpp
/*правило*/
{
  /* Список методов */
  "methods": ["<<method-name-1>>", "<<method-name-2>>"],
  /* Цель для этих методов */
  "target": "<<target-name>>"
}
```

## Правила для параметров

```cpp
 {
  /* Список методов */
  "methods": ["<<method-name-1>>", "<<method-name-2>>"],
  /* Цель для этих методов */
  "target": "<<target-name>>"
  /* Режим сравнения для имен полей и их значений */
  "params_mode": "FullMatchName|PrefixMatchValue",
  /* Список полей запроса */
  "params": {
    "arg1": "value1",
    "arg2": "value2"
  }
}
```
